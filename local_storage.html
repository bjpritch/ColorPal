<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>html5 local file upload demo</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v10">
<meta name="syntax" content="html">
<meta name="settings" content="use_css,pre_wrap,expand_tabs">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #d7d7d7; }
body { font-family: monospace; color: #d7d7d7; background-color: #1c1c1c; }

#colorpal_canvas { 
    border: 3px solid #000;
    width: 400px;
    height: 300px;
    margin: 0 20px;
    clear: both;

    -webkit-transition: all 0.33s ease-in; /* Safari and Chrome */
       -moz-transition: all 0.33s ease-in; /* Firefox 4 */
         -o-transition: all 0.33s ease-in; /* Opera */
            transition: all 0.33s ease-in;
}

#swatches {
    line-height: 0;
    border: 1px solid black;
    height: 66px;
    background: grey;
    position: relative;

    -webkit-transition : top ease 0.2s;
       -moz-transition : top ease 0.2s;
         -o-transition : top ease 0.2s;
            transition : top ease 0.2s;

    -webkit-border-radius: 6px;
       -moz-border-radius: 6px;
         -o-border-radius: 6px;
            border-radius: 6px;
}

.swatch {
    display : block;
    float   : left;
    width   : 50px;
    height  : 50px;
    margin  : 8px;
    border  : 1px solid black;

    -webkit-box-shadow : 0px 0px 9px 0px rgba( 0, 0, 0, 0.8 );
       -moz-box-shadow : 0px 0px 9px 0px rgba( 0, 0, 0, 0.8 );
         -o-box-shadow : 0px 0px 9px 0px rgba( 0, 0, 0, 0.8 );
            box-shadow : 0px 0px 9px 0px rgba( 0, 0, 0, 0.8 );

    -webkit-border-radius: 3px;
       -moz-border-radius: 3px;
         -o-border-radius: 3px;
            border-radius: 3px;
}
-->
</style>

<script type="text/javascript" src="median-cut.js"> </script>
<script type="text/javascript" src="imagedata_to_rgb.js"> </script>
<script type="text/javascript">

var ctx, canvas, mc;

function handle_file_select( evt ) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList and render image files as thumbnails.
    for ( var i = 0, f; f = files[i]; i++ ) {

        // Only process image files.
        if (!f.type.match('image.*')) {
            continue;
        }

        var reader   = new FileReader();
        var img      = document.createElement("img");
        var swatches = document.getElementById("swatches")

        img.onload = function() {

            // Resize the canvas to the image size
            canvas.width             = img.width;
            canvas.height            = img.height;

            // Resize the canvas with CSS to trigger CSS3 transitions
            canvas.style.width       = img.width + "px";
            canvas.style.height      = img.height + "px";
            canvas.style.borderStyle = "solid";

            // Draw the image inside the canvas
            ctx.drawImage(img, 0, 0, img.width, img.height);

            var data = ctx.getImageData( 0, 0, img.width, img.height );
            var rgbdata = imagedata_to_rgb( data );
            mc = MedianCut();
            mc.init( rgbdata );
            var palette = mc.get_dynamic_size_palette(48);

            // clear any previous swatches
            //swatches.clear();

            for( var ic = palette.length - 1; ic >= 0; ic-- ) {
                var color = palette[ic];
                var sp = document.createElement("span");
                sp.setAttribute( "id", "swatch" + ic );
                sp.setAttribute( "class", "swatch" );
                sp.onclick = function() { document.body.style.backgroundColor = this.style.backgroundColor; };
                sp.style.backgroundColor = "rgb(" + parseInt(color[0]) + "," + parseInt(color[1]) + "," + parseInt(color[2]) + ")";
                swatches.appendChild( sp );
            }


        };

        // Read in the image file as a data URL.
        reader.readAsDataURL(f);

        reader.onload = function(e) {

            // Assign the image's src to the filesystem image's data URL [http://en.wikipedia.org/wiki/Data_URI_scheme]
            img.src = e.target.result; 

        };
    }
}

window.onload = function() {
    document.getElementById("colorpal_input_image").onchange = handle_file_select;
    canvas = document.getElementById("colorpal_canvas");
    ctx = canvas.getContext("2d");
};



</script>

</head>
<body>
<pre>

<h1>HTML5 local file upload demo</h1>

<input type="file" id="colorpal_input_image"></input>

<div id="list"></div>


<div id="swatches">

</div>

<canvas id="colorpal_canvas"></canvas>

</pre>
</body>
</html>

