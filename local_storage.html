<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>html5 local file upload demo</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v10">
<meta name="syntax" content="html">
<meta name="settings" content="use_css,pre_wrap,expand_tabs">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #d7d7d7; background-color: #1c1c1c; }
body { font-family: monospace; color: #d7d7d7; background-color: #1c1c1c; }

#colorpal_canvas { 
    border: 3px dotted #888;
    width: 400px;
    height: 300px;
    margin: 0 20px;
}

#colorpal_canvas
{
    -webkit-transition: all 0.33s ease-in; /* Safari and Chrome */
       -moz-transition: all 0.33s ease-in; /* Firefox 4 */
         -o-transition: all 0.33s ease-in; /* Opera */
            transition: all 0.33s ease-in;
}
-->
</style>

<script type="text/javascript">

var ctx, canvas;
var canvas_resize_class = "width: {0}; height: {1}; border-style: solid;";

function handle_file_select( evt ) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList and render image files as thumbnails.
    for (var i = 0, f; f = files[i]; i++) {

        // Only process image files.
        if (!f.type.match('image.*')) {
            continue;
        }

        var reader = new FileReader();
        var img    = document.createElement("img");

        reader.onload = function(e) {

            // Assign the image's src to the filesystem image's data URL [http://en.wikipedia.org/wiki/Data_URI_scheme]
            img.src = e.target.result; 

            // Output a bit of the image's data
            //console.log( img.src.slice(0,50) + "......." );

            // Resize the canvas to the image size
            canvas.width             = img.width;
            canvas.height            = img.height;

            // Resize the canvas with CSS to trigger CSS3 transitions
            canvas.style.width       = img.width.toString() + "px";
            canvas.style.height      = img.height.toString() + "px";
            canvas.style.borderStyle = "solid";

            // Draw the image inside the canvas
            // TODO: why does it draw the image with the wrong dimensions now?
            ctx.drawImage(img, 0, 0, img.width, img.height);

        };

        // Read in the image file as a data URL.
        reader.readAsDataURL(f);
    }
}

window.onload = function() {
    document.getElementById("colorpal_input_image").onchange = handle_file_select;
    canvas = document.getElementById("colorpal_canvas");
    ctx = canvas.getContext("2d");
};



</script>

</head>
<body>
<pre>

<h1>HTML5 local file upload demo</h1>

<p>choose an image from your local filesystem.  it will be drawn in a canvas element below.</p>

<input type="file" id="colorpal_input_image"></input>

<div id="list"></div>

<canvas id="colorpal_canvas"></canvas>

</pre>
</body>
</html>

